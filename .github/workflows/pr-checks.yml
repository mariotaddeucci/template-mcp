name: PR Quick Checks

on:
  pull_request:
    types: [opened, synchronize, reopened]

env:
  PYTHON_VERSION: "3.12"

jobs:
  quick-checks:
    name: Quick Quality Checks
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Install uv
      uses: astral-sh/setup-uv@v4
      with:
        version: "latest"

    - name: Set up Python
      run: uv python install ${{ env.PYTHON_VERSION }}

    - name: Install dependencies
      run: uv sync --all-extras

    - name: Check code formatting
      run: uv run task format-check

    - name: Run linting
      run: uv run task lint

    - name: Run basic tests
      run: uv run task test

  pr-info:
    name: PR Information
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request'
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Get PR info
      run: |
        echo "## PR Summary" >> $GITHUB_STEP_SUMMARY
        echo "- **Branch:** ${{ github.head_ref }}" >> $GITHUB_STEP_SUMMARY
        echo "- **Target:** ${{ github.base_ref }}" >> $GITHUB_STEP_SUMMARY
        echo "- **Author:** ${{ github.actor }}" >> $GITHUB_STEP_SUMMARY
        
        # Count changes
        ADDED=$(git diff --numstat ${{ github.base_ref }}..HEAD | awk '{added += $1} END {print added}')
        DELETED=$(git diff --numstat ${{ github.base_ref }}..HEAD | awk '{deleted += $2} END {print deleted}')
        FILES=$(git diff --name-only ${{ github.base_ref }}..HEAD | wc -l)
        
        echo "- **Files changed:** $FILES" >> $GITHUB_STEP_SUMMARY
        echo "- **Lines added:** $ADDED" >> $GITHUB_STEP_SUMMARY
        echo "- **Lines deleted:** $DELETED" >> $GITHUB_STEP_SUMMARY
        
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### Changed Files" >> $GITHUB_STEP_SUMMARY
        git diff --name-only ${{ github.base_ref }}..HEAD | head -20 | sed 's/^/- /' >> $GITHUB_STEP_SUMMARY